<link rel="stylesheet" type="text/css" href="pages/css/shared/default.css" />
<link rel="stylesheet" type="text/css" href="pages/css/pages/project.css" />
<link rel="stylesheet" type="text/css" href="pages/css/shared/angucomplete-alt.css"/>
<link rel="stylesheet" type="text/css" href="pages/css/shared/fonts.css">

<div class="container">

	<div id="menu-left-tabs" class="menu-tabs left" ondragstart="return false;" ondrop="return false;">
		<div class="menu-tab" data-ng-class="{ 'selectedTab' : showDocuments }" data-ng-click="showDocuments = !showDocuments; showTypo = false; showInsert = false;">
			<img src="pages/images/documents.svg" width="20">
		</div>
		<div class="menu-tab" data-ng-class="{ 'selectedTab' : showTypo }" data-ng-click="showTypo = !showTypo; hideStyleEditor(); showDocuments = false; showInsert = false; focusEditor();">
			<img src="pages/images/typography.svg" width="20">
		</div>
		<div class="menu-tab" data-ng-class="{ 'selectedTab' : showInsert }" data-ng-click="showInsert = !showInsert; showDocuments = false; showTypo = false;">
			<img src="pages/images/insert.svg" width="20">
		</div>
	</div>
	<div id="menu-left" class="menu-left" data-ng-class="{ 'open' : showDocuments || showTypo || showInsert, 'bottom-menu-space' : showDocuments || showTypo }">
		<div class="menu-item-left documents" data-ng-show="showDocuments">
			<div class="projectDocument new" data-ng-click="addProjectDocument();">
				<p>+</p>
			</div>
			<div html-sortable="sortable_option" data-ng-model="projectDocuments">
				<div class="projectDocument" data-ng-repeat="projectDocument in projectDocuments track by projectDocument._id" data-ng-selected="documentSelected === projectDocument" data-ng-hide="projectDocument.archived && !user.showArchivedDocuments" data-ng-class="{ 'archived' : projectDocument.archived }">
					<a class="projectdocument-options-show" data-ng-class="{ 'open' : showProjectDocumentOptions }" data-ng-click="showProjectDocumentOptions = !showProjectDocumentOptions">
						<div class="arrow"></div>
					</a>

					<p data-ng-hide="editingProjectDocumentTitle">
						<a class="projectDocument-link" data-ng-click="projectDocumentChosen(projectDocument)">
							{{projectDocument.name}}
						</a>
					</p>

					<form data-ng-show="editingProjectDocumentTitle">
						<p>
							<textarea id="renameProjectDocument" rows="4" data-ng-model="projectDocument.name" focus-on="!!editingProjectDocumentTitle" on-enter="editingProjectDocumentTitle = false; renameProjectDocument(projectDocument);"></textarea>
						</p>
					</form>

					<div class="projectDocument-options" data-ng-show="showProjectDocumentOptions">
						<div class="projectDocument-options-menupoint first" data-ng-click="editingProjectDocumentTitle = true; showProjectDocumentOptions = false;">rename</div>
						<div class="projectDocument-options-menupoint" data-ng-hide="projectDocument.archived" data-ng-click="archiveProjectDocument(projectDocument); showProjectDocumentOptions = false;">archive</div>
						<div class="projectDocument-options-menupoint" data-ng-show="projectDocument.archived" data-ng-click="unarchiveProjectDocument(projectDocument); showProjectDocumentOptions = false;">unarchive</div>
						<div class="projectDocument-options-hide" data-ng-click="showProjectDocumentOptions = false;" title="Close Options"></div>
					</div>
				</div>
			</div>
		</div>
		<div class="menu-item-left" data-ng-show="showTypo">
			<div class="typo new" data-ng-click="addNewStyleset()">
				<p>+</p>
			</div>
			<ul>
				<li data-ng-repeat="styleset in stylesets track by $index" class="typo" data-ng-class="{ 'open' : typoChildrenVisible }" data-ng-hide="styleset.archived || styleset.hidden">
					<a class="styleset-options-show" data-ng-click="typoChildrenVisible = true; showStylesetOptions = !showStylesetOptions" data-ng-class="{ 'open' : showStylesetOptions }">
						<div class="arrow"></div>
					</a>

					<p class="not-selectable" data-ng-style="styleset.css" data-ng-click="typoChildrenVisible =! typoChildrenVisible; showStylesetOptions = false; focusEditor();" data-ng-hide="styleset.rename">{{styleset.name}}</p>

					<form data-ng-show="styleset.rename">
						<p>
							<textarea id="renameStyleset" rows="1" data-ng-model="styleset.name" focus-on="!!styleset.rename" on-enter="toggleRename(styleset); renameStyleset(styleset);"></textarea>
						</p>
					</form>

					<div class="styleset-options" data-ng-show="showStylesetOptions">
						<div class="styleset-options-menupoint first" data-ng-click="toggleRename(styleset); showStylesetOptions = false;">rename</div>
						<div class="styleset-options-menupoint" data-ng-click="archiveStyleset(styleset); showStylesetOptions = false;">archive</div>
						<div class="styleset-options-menupoint" data-ng-click="applyStylesetToDocument(styleset,true); showStylesetOptions = false;">apply to document</div>
						<div class="styleset-options-menupoint" data-ng-click="applyStylesetToProject(styleset); showStylesetOptions = false;">apply to ebook</div>
					</div>

					<ul data-ng-show="typoChildrenVisible || isDefaultStyleset(styleset)" class="typo-children">
						<li data-ng-repeat="style in styleset.styles track by $index" id="{{style._id}}" data-ng-hide="style.archived || style.hidden" data-ng-selected="selectedStyle._id === style._id">
							<a class="style-options-show" data-ng-click="showStyleOptions = !showStyleOptions" data-ng-class="{ 'open' : showStyleOptions }">
								<div class="arrow"></div>
							</a>

							{{style.tag === 'h1' && setStylesetStyling(styleset, style) || ''}}

							<div class="style-height" data-ng-hide="style.rename">
								<span class="not-selectable" data-ng-style="getStyleStyling(style)" data-ng-click="applyStyle(styleset, style)">{{style.name}}</span>
							</div>

							<div class="style-copy-options" data-ng-show="copyCSS && selectedStyle._id === style._id">
								<ul>
									<!--<li><a data-ng-click="saveAsCharStyle(styleset, style)">save as character style</a></li>-->
									<li><a data-ng-click="saveAsBlockStyle(styleset, style)">save as new</a></li>
									<li><a data-ng-click="overwriteStyle(style)">overwrite</a></li>
								</ul>
							</div>

							<form data-ng-show="style.rename">
								<textarea id="renameStyle" rows="1" data-ng-model="style.name" focus-on="!!style.rename" on-enter="toggleRename(style); updateStyle(style);"></textarea>
							</form>

							<div class="style-options" data-ng-show="showStyleOptions">
								<div class="style-options-menupoint first" data-ng-click="toggleRename(style); showStyleOptions = false;">rename</div>
								<div class="style-options-menupoint" data-ng-click="archiveStyle(style); showStyleOptions = false;">archive</div>
							</div>
						</li>
						<li class="new style" data-ng-click="addNewStyle( styleset )"><p>+</p></li>
					</ul>
				</li>
			</ul>
		</div>
		<div class="menu-item-left inserts" data-ng-show="showInsert">
			<ul>
				<!--<li data-ng-click="insertOptionChosen('showInsertBoxOptions');" class="insertOption" data-ng-class="{ 'expanded' : activeInsertOption === 'showInsertBoxOptions' }">
					<img src="pages/images/insert_box_button.png" alt="" title="" />
				</li>-->
				<li data-ng-click="insertOptionChosen('showInsertHyperlinkOptions');" class="insertOption first" data-ng-class="{ 'expanded' : activeInsertOption === 'showInsertHyperlinkOptions' }">
					<img src="pages/images/insert_hyperlink_button.png" alt="Hyperlink" title="Hyperlink" />
				</li>
				<li data-ng-click="insertOptionChosen('showInsertImageOptions');" class="insertOption" data-ng-class="{ 'expanded' : activeInsertOption === 'showInsertImageOptions' }">
					<img src="pages/images/insert_image_button.png" alt="Image" title="Image" />
				</li>
				<!--<li class="insertOptionProperties" data-ng-class="{ 'expanded' : activeInsertOption === 'showInsertBoxOptions' }">
					line properties
					<div class="left-menu-divider"></div>
					padding settings
					<div class="left-menu-divider"></div>
					margin settings
				</li>-->
				<li class="insertOptionProperties" data-ng-class="{ 'expanded' : activeInsertOption === 'showInsertHyperlinkOptions' }">
					<div class="left-menu-options">
						<span class="menu-box inputfield full-size">
							<input type="text" data-ng-model="linkAddress" placeholder="Target">
						</span>
						<span class="menu-box inputfield full-size left-menu-parameter-margin">
							<input type="text" data-ng-model="linkText" placeholder="Text">
						</span>
						<span class="menu-box inputfield full-size left-menu-parameter-margin">
							<select data-ng-model="linkAnchor" data-ng-options="anchor.text for anchor in toc">
								<option value="">Choose internal target</option>
							</select>
						</span>
						<span class="left-menu-button full-size left-menu-parameter-margin">
							<a data-ng-click="insertNewLink();">+</a>
						</span>
					</div>
				</li>
				<li class="insertOptionProperties" data-ng-class="{ 'expanded' : activeInsertOption === 'showInsertImageOptions' }">
					<div class="left-menu-options">
						<span class="menu-box">
							<input type="file" id="imagesInput" data-ng-file-select="onImageSelect($files)" accept="image/*" data-ng-hide="true">
							<label for="imagesInput">Click to insert an image</label>
						</span>
					</div>
					<!--<div class="left-menu-options left-menu-parameter-margin">
						<span class="left-menu-button">
							<a data-ng-click="alignImageLeft(); insertImageOption('')">
								<img src="/create/ckeditor/skins/scripler/icons/image.png" title="Align Image Left" />
							</a>
						</span>
						<span class="left-menu-button">
							<a data-ng-click="alignImageCenter(); insertImageOption('')">
								<img src="/create/ckeditor/skins/scripler/icons/image.png" title="Align Image Center" />
							</a>
						</span>
						<span class="left-menu-button">
							<a data-ng-click="alignImageRight(); insertImageOption('')">
								<img src="/create/ckeditor/skins/scripler/icons/image.png" title="Align Image Right" />
							</a>
						</span>
						<span class="left-menu-button">
							<a data-ng-click="insertImageOption('turnImage')">
								<img src="/create/ckeditor/skins/scripler/icons/image.png" title="Turn Image" />
							</a>
						</span>
						<span class="left-menu-button">
							<a data-ng-click="duplicateImage(); insertImageOption('')">
								<img src="/create/ckeditor/skins/scripler/icons/image.png" title="Duplicate Image" />
							</a>
						</span>
						<span class="left-menu-button">
							<a data-ng-click="insertImageOption('resizeImage')">
								<img src="/create/ckeditor/skins/scripler/icons/image.png" title="Resize Image" />
							</a>
						</span>
					</div>
					<div class="left-menu-options-parameters left-menu-parameter-margin">
						<div data-ng-class="{ 'expanded' : activeImageOption === 'turnImage' }">
							<span class="left-menu-button">
								<img src="/create/ckeditor/skins/scripler/icons/image.png" title="Resize Image Set Procentages" />
							</span>
							<span class="menu-box inputfield">
								<input type="text" value="45" class="show-info">
								<span class="extra-info">&deg;</span>
							</span>
						</div>
						<div data-ng-class="{ 'expanded' : activeImageOption === 'resizeImage' }">
							<span class="left-menu-button">
								<img src="/create/ckeditor/skins/scripler/icons/maximize.png" title="Resize Image Set Procentages" />
							</span>
							<span class="menu-box inputfield">
								<input type="text" value="100" class="show-info">
								<span class="extra-info">%</span>
							</span>
						</div>
					</div>-->
				</li>

				<li data-ng-click="insertOptionChosen('showInsertPagebreakOptions');" class="insertOption first" data-ng-class="{ 'expanded' : activeInsertOption === 'showInsertPagebreakOptions' }">
					<img src="pages/images/insert_pagebreak_button.png" alt="Pagebreak" title="Pagebreak" />
				</li>
				<li data-ng-click="insertOptionChosen('showInsertAnchorOptions');" class="insertOption" data-ng-class="{ 'expanded' : activeInsertOption === 'showInsertAnchorOptions' }">
					<img src="pages/images/insert_anchor_button.png" alt="Anchor" title="Anchor" />
				</li>
				<li class="insertOptionProperties" data-ng-class="{ 'expanded' : activeInsertOption === 'showInsertPagebreakOptions' }">
					<div>
						<span class="left-menu-button">
							<a data-ng-click="insertPageBreak()">
								<img src="/create/ckeditor/skins/scripler/icons/pagebreak.png" title="Insert the pagebreak" />
							</a>
						</span>
						<!--<span class="left-menu-button">
							<a data-ng-click="insertPageBreakAvoid()">
								<img src="/create/ckeditor/skins/scripler/icons/pagebreak.png" title="Avoid pagebreak" />
							</a>
						</span>-->
					</div>
				</li>
				<!--<li class="insertOption"><img src="pages/images/insert_cover_button.png" width="80" height="80"></li>-->
				<li class="insertOptionProperties" data-ng-class="{ 'expanded' : activeInsertOption === 'showInsertAnchorOptions' }">
					<div class="left-menu-options">
						<span class="menu-box inputfield">
							<input type="text" data-ng-model="anchorName" placeholder="Anchor name">
						</span>
						<span class="left-menu-button">
							<a data-ng-click="insertNewAnchor();">+</a>
						</span>

						<span class="menu-box left-menu-parameter-margin">
							<span class="option" data-ng-repeat="tocs in toc"><a data-ng-click="anchorScrollTo(tocs);">{{tocs.text}}</a></span>
						</span>
					</div>
				</li>
				<!--<li class="insertOptionProperties" data-ng-class="{ 'expanded' : activeInsertOption === 'showInsertBoxOptions'showInsertHyperlinkOptions }">
					this is the options for insert hyperlink
				</li>-->
			</ul>
		</div>
		<div class="documents-options-bottom-buttons" data-ng-show="showDocuments">
			<a data-ng-class="{ 'open' : showNewOptions }" data-ng-click="showNewOptions = !showNewOptions; showImportOptions = false; showBottomOptions = false;">new</a>
			<a data-ng-class="{ 'open' : showImportOptions }" data-ng-click="showImportOptions = !showImportOptions; showNewOptions = false; showBottomOptions = false;">import</a>
			<a class="last" data-ng-class="{ 'open' : showBottomOptions }" data-ng-click="showBottomOptions = !showBottomOptions; showNewOptions = false; showImportOptions = false;">options</a>
		</div>

		<div class="stylesets-options-bottom-buttons" data-ng-show="showTypo">
			<a data-ng-click="showStyleEditor()" data-ng-class="{ 'open' : styleEditorVisible }">style editor</a>
		</div>

		<div id="menu-left-content-options" class="menu-options" data-ng-show="showDocuments" data-ng-class="{ 'open' : showNewOptions || showImportOptions || showBottomOptions }">
			<div class="options-bottom-box">
				<div data-ng-show="showNewOptions">
					<a data-ng-click="addProjectDocument()">New Chapter</a><br>
				</div>
				<div data-ng-show="showImportOptions">
					<div class="upload-box" data-ng-file-drop="onFileSelect($files)" data-ng-file-drag-over-class="dragover"
						 data-ng-show="dropSupported" data-ng-file-drop-available="dropSupported=true">drop files here</div>
					<p>Scripler imports Word files and other common word processor formats (link).</p>
					<input type="file" data-ng-file-select="onFileSelect($files)">
				</div>
				<div data-ng-show="showBottomOptions">
					<input type="checkbox" data-ng-model="user.showArchivedDocuments" data-ng-change="updateUser();">Show Archived Content<br>
				</div>
			</div>
		</div>
	</div>

	<div class="editor">
		<p class="breadcrumb">
			<a class="breadcrumb" href="#">Ebooks</a> / <span data-ng-bind="project.name"></span> / <span data-ng-bind="documentSelected.name"></span>
		</p>
		<p class="savedstamp">
			<span data-ng-bind="lastSaved"></span>
		</p>
		<!-- TODO: do this in a nicer way! In CSS? -->
		<div style="clear: both;"></div>
	</div>

	<div class="editor">
		<div id="toolbar-area" class="toolbar-area"></div>
		<textarea ck-editor="" data-ng-model="documentSelected.text" class="form-control" id="bodyeditor"></textarea>
	</div>

	<div id="menu-right-tabs" class="menu-tabs right" ondragstart="return false;" ondrop="return false;">
		<div class="menu-tab" data-ng-class="{ 'selectedTab' : showFinalizeOptions }" data-ng-click="showFinalizeOptions = !showFinalizeOptions; showOutput = false;">
			<img src="pages/images/finalize.svg" width="20">
		</div>
		<div class="menu-tab output" data-ng-class="{ 'selectedTab' : showOutput }" data-ng-click="showOutput = !showOutput; showFinalizeOptions = false;">
			<img src="pages/images/output.svg" width="20">
		</div>
		<div class="menu-tab feedback">
			<img src="pages/images/feedback.svg" width="20">
		</div>
	</div>
	<div id="menu-right" class="menu-right" data-ng-class="{ 'open' : showFinalizeOptions || showOutput }">
		<div class="menu-item-right inserts" data-ng-show="showFinalizeOptions">
			<ul>
				<li data-ng-click="finalizeOptionChosen('showFinalizeCoverOptions');" class="insertOption first" data-ng-class="{ 'expanded' : activeFinalizeOption === 'showFinalizeCoverOptions' }">
					<img src="pages/images/insert_cover.png" alt="Add cover image" title="Add cover image" />
				</li>
				<li data-ng-click="finalizeOptionChosen('showFinalizeTitlepageOptions');" class="insertOption" data-ng-class="{ 'expanded' : activeFinalizeOption === 'showFinalizeTitlepageOptions' }">
					<img src="pages/images/insert_titlepage.png" alt="Title page" title="Title page" />
				</li>
				<li class="insertOptionProperties" data-ng-class="{ 'expanded' : activeFinalizeOption === 'showFinalizeCoverOptions' }">
					<span class="right-menu-feature-title">
						Add cover
					</span>
					<span class="right-menu-feature-text">
						Add an existing cover image to the beginning of the book. This image will also represent the book on virtual book shelves and in ebook stores.
					</span>
					<span class="menu-box center-text right-menu-parameter-margin">
						<input type="file" id="coverInput" data-ng-file-select="onCoverSelect($files)" accept="image/*" data-ng-hide="true">
						<label for="coverInput">Add cover image</label>
					</span>
				</li>
				<li class="insertOptionProperties" data-ng-class="{ 'expanded' : activeFinalizeOption === 'showFinalizeTitlepageOptions' }">
					<span class="right-menu-feature-title">
						Generate Title page
					</span>
					<span class="right-menu-feature-text">
						A title page usually bears the full title, the author and similar. It is usually found at the beginning of a book.
					</span>
					<span class="right-menu-button full-size right-menu-parameter-margin">
						<a data-ng-click="generateTitlePage();">Generate</a>
					</span>
				</li>

				<li data-ng-click="finalizeOptionChosen('showFinalizeTocOptions');" class="insertOption first" data-ng-class="{ 'expanded' : activeFinalizeOption === 'showFinalizeTocOptions' }">
					<img src="pages/images/insert_toc.png" alt="Generate Table of Contents" title="Generate Table of Contents" />
				</li>
				<li data-ng-click="finalizeOptionChosen('showFinalizeColophonOptions');" class="insertOption" data-ng-class="{ 'expanded' : activeFinalizeOption === 'showFinalizeColophonOptions' }">
					<img src="pages/images/insert_colophon.png" alt="Generate Colophon" title="Generate Colophon" />
				</li>
				<li class="insertOptionProperties" data-ng-class="{ 'expanded' : activeFinalizeOption === 'showFinalizeTocOptions' }">
					<span class="right-menu-feature-title">
						Generate<br />Table of Contents
					</span>
					<span class="right-menu-feature-text">
						The table of contents will be inserted in the beginning of the ebook and will be accessible in ebook readers for easy navigation.
					</span>
					<span class="right-menu-feature-text">
						<br />Preview
					</span>
					<span class="menu-box right-menu-parameter-margin">
						<span class="option" data-ng-repeat="tocs in toc"><a data-ng-click="anchorScrollTo(tocs);">{{tocs.text}}</a></span>
					</span>
					<span class="right-menu-button full-size right-menu-parameter-margin">
						<a data-ng-click="generateToc();">Generate</a>
					</span>
				</li>
				<li class="insertOptionProperties" data-ng-class="{ 'expanded' : activeFinalizeOption === 'showFinalizeColophonOptions' }">
					<span class="right-menu-feature-title">
						Generate Colophon
					</span>
					<span class="right-menu-feature-text">
						A colophon is a brief statement containing information about a specific version of a book such as the ISBN-number, a creative commons or copyright notice, the people involved and so on.
					</span>
					<span class="right-menu-button full-size right-menu-parameter-margin">
							<a data-ng-click="generateColophon();">Generate</a>
					</span>
				</li>
			</ul>
		</div>
		<div class="menu-item-right output" data-ng-show="showOutput">
			<ul>
			<li class="outputOptionProperties">
				<span class="menu-box label">Title</span>
				<span class="menu-box inputfield full-size" data-ng-class="{ 'text-saved': metaTitleSaved }">
					<input type="text" name="output_title" id="output_title" data-ng-model="project.metadata.title" data-ng-model-options="{ debounce: 2000 }"  />
					<span class="statusfield" data-ng-class="{ 'text-saved': metaTitleSaved }">Saved</span>
				</span>
				<span class="menu-box label left-menu-parameter-margin">Author</span>
				<span class="menu-box inputfield full-size" data-ng-class="{ 'text-saved': metaAuthorsSaved }">
					<input type="text" name="output_author" id="output_author" data-ng-model="project.metadata.authors" data-ng-model-options="{ debounce: 2000 }" />
					<span class="statusfield" data-ng-class="{ 'text-saved': metaAuthorsSaved }">Saved</span>
				</span>
				<span class="menu-box label left-menu-parameter-margin">Language</span>
				<span class="menu-box inputfield full-size" data-ng-class="{ 'text-saved': metaLanguageSaved }">
					<form class="angucomplete">
						<div angucomplete-alt id="output_language" placeholder="Search Languages" pause="100" selected-object="selectedLanguage" local-data="languages" search-fields="description,subtag" title-field="description" minlength="1" match-class="angucomplete-highlight" initial-value="{{selectedLanguageName}}" field-required="true">
						</div>
					</form>
					<span class="statusfield" data-ng-class="{ 'text-saved': metaLanguageSaved }">Saved</span>
				</span>
				<span class="menu-box label left-menu-parameter-margin">Description</span>
				<span class="menu-box inputfield full-size-text" data-ng-class="{ 'text-saved': metaDescriptionSaved }">
					<textarea name="output_description" id="output_description" data-ng-model="project.metadata.description" data-ng-model-options="{ debounce: 2000 }" /></textarea>
					<span class="statusfield" data-ng-class="{ 'text-saved': metaDescriptionSaved }">Saved</span>
				</span>
				<span class="menu-box label left-menu-parameter-margin">Unique identifier / ISBN</span>
				<span class="menu-box inputfield full-size" data-ng-class="{ 'text-saved': metaIsbnSaved }">
					<input type="text" name="output_unique" id="output_unique" data-ng-model="project.metadata.isbn" data-ng-model-options="{ debounce: 2000 }" />
					<span class="statusfield" data-ng-class="{ 'text-saved': metaIsbnSaved }">Saved</span>
				</span>
			</li>
			<li class="outputOptionProperties outputOptionDownload">
				<span class="menu-box label text-align-center">Download ebook</span>
				<span class="menu-box label left-menu-parameter-margin left-menu-download">
					<img title="Download epub" class="download-icon" src="pages/images/compile_epub.png" data-ng-click="exportEpub()">
				</span>
			</li>
			</ul>
		</div>
	</div>
</div>
